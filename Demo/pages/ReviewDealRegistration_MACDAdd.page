<apex:page controller="ReviewDealRegController" standardStylesheets="false" action="{!returnConfigPage}" sidebar="false" showHeader="false" tabStyle="Apttus_Proposal__Proposal__c" docType="html-5.0" applyHtmlTag="false" applyBodyTag="false">
    <apex:includeScript value="{!URLFOR($Resource.bootstrapMin, 'js/bootstrap.min.js')}" />
    <apex:includescript value="//cdn.datatables.net/1.10.11/js/jquery.dataTables.min.js" />
    <style>
        .scrollToTop{ padding:10px; text-align:center; font-weight: bold; color: #444; text-decoration: none; position:fixed; top:80%; right:30px; display:none; .background: url(url('!$Resource.scrollTop') no-repeat center;) no-repeat 0px 20px; width:72px; height:106px; z-index: 9999; }    
         .scrollToTop:hover{
            text-decoration:none;
        }
        .tableSection thead {
            background-color: white;
        }
        #pricingSmryTable td {
            border: 0px;
        }
        .open input {
            border-bottom-left-radius: 0 !important;
            border-bottom-right-radius: 0 !important;
        }        
        ul.dropdown-menu>li>a {
     
         font-family: omnes_att_iimedium;
            line-height: 30px;
            text-align: center;
        }
        ul.dropdown-menu {
            width: 100%;
            margin-top:0;
            border-top-left-radius: 0;
            border-top-right-radius: 0;
            border: 1px solid #939393;
            border-top:none;
            box-shadow: none;
        }
        ul.dropdown-menu .divider{
            border: 1px solid #939393;
        }
        table#pricingSmryTable {
            border-spacing: 10px;
            border-collapse: inherit;
            margin-top: 20px;
        }
        tbody tr:nth-child(odd),tbody tr:nth-child(even) {
            background: none !important;
        }        
        .potentialClass{ 
            font-size: 9pt !important;      
            font-family:omnes_att_iimedium !important;      
            padding-top: 16px !important;       
            color: #000000;     
            font-style: normal;     
            text-align: left;       
            line-height: 10.8pt;        
            letter-spacing: 0em;        
        }       
        
        .dealClass{     
            font-size: 13pt important;     
            font-family:omnes_att_iimedium;      
            font-style: normal;     
            color: #000 !important;     
            line-height: 15.6pt;        
            text-align: left;       
            letter-spacing: 0em;        
        } 
        .addNewAddressBtn input{
            margin-left: 20px;
            padding: 0 20px !important;
        }
        .totalSitesCount{
            float: right;
            font-size: 20px;
            color: #007a3e !important;
            font-family: omnes_att_iimedium;
        } 
        .searchSection{
            margin-bottom: 35px;
            width: 100%;
            float: left;
        }
        .exportQuoteLinkSection{
            float:right;
            width: 100%;
            margin-bottom:10px;
            margin-top:-25px;
        }
        .exportQuoteLinkSection a{
            float:right;
            color: #009edb;
            font-family: omnes_att_iimedium;        
        }
        .exportQuoteLinkSection .tooltipTrigger{
            float:right;
            margin-left:5px;
        }           
        .sortingIcon{
            margin-left: 0;
            float: right;
            top: 5px;           
        }       
        .tableSection thead{
            color: #009edb;
        }
        .tableSection table{
            border-color: #939393 !important;
        }        
        .tableSection .table-bordered>thead>tr>th{
            border-bottom: 1px dashed #939393;
            border-left-color: #939393;
            border-right-color: #939393;
        }
        .tableSection .table-bordered>tbody>tr>td{
            border:none !important;
        }
        .tableSection .table>tbody>tr>td{
            border-top: 1px dashed #939393 !important;
            border-right: 1px solid #939393 !important;
        }
        .tableSection tbody tr:nth-child(odd) {
            background: #f2f2f2;
        }
        .tableSection tbody tr:nth-child(even) {
            background: #fff;
        }
        .tableSection .table a{
            color: #009edb !important;
            font-family: omnes_att_iimedium;        
        }        
        .goToDashboardLink{
            color: #0568ad;
            font-family: omnes_att_iimedium; 
            float: right;
            margin-right: 30px;
            margin-top: 9px;        
        }        
        .greenText{
            color: #007a3e !important;
            font-family: omnes_att_iimedium !important;
        }
        .orangeText{
            color: #ea7400 !important;
            font-family: omnes_att_iimedium !important;;
        }
        .dataTableManageCustSearchButton {
            position: absolute;
            display: inline;
            top: 3px;
            z-index: 9;
        }
        .noSearchDataAvailable{
            color: #000;
            font-weight: bold;
            background-color: #fff !important;
        }
        .tooltipTrigger + .tooltip > .tooltip-inner {
            background-color: #fff;
            color:#000;
            font-family:omnes_att_iimedium;
            box-shadow: rgba(0, 0, 0, 0.1) 1px 1px 2px 1px;
            text-align: left;
            font-weight: normal;
            z-index:999;
        }
        .tooltipTrigger + .tooltip.top > .tooltip-arrow {
             border-top-color:#fff; 
             border-left:12px solid transparent;
             border-right:12px solid transparent;
             border-top:12px solid #fff;        
            top:58px;
             left:45%
        }         
        .tooltip.top{
            width:173px;
            z-index:999;        
        }
        .tableSortingClass{
            width:100% !important;
        }
        .dividerHr{clear:both;}
        table.dataTable thead .sorting_desc {
             background-image: url(portalDesignImg/app_icons.svg), none !important; 
        }
        table.dataTable thead .sorting_asc {
             background-image: url(portalDesignImg/app_icons.svg), none !important; 
        }
        table.dataTable thead .sorting {
             background-image: url(portalDesignImg/app_icons.svg), none !important; 
        }
    </style>
    
    <apex:form id="RegDealFormId">        
        <apex:outputPanel id="pricingsummaryId">
            <h3 class="m-t-0" style="font-size: 35px;margin-bottom: 40px;">Review Request</h3>
            <apex:outputPanel rendered="{!!isOfflineMode}">
                <div class="f-s-18" style="margin-bottom: 30px;" id="successMsgSection">
                    <apex:outputPanel rendered="{!Opp.StageName = 'Deal Registration Approved' || Opp.StageName = 'Deal Reg Auto-Approved'}">
                        <label class="greenText">Your deal registration request is Approved. The following reflects your available discounts.</label>
                        <br/><br/>
                    </apex:outputPanel>
                    <apex:outputPanel rendered="{!(QuoteStatusValue != 'Deal Reg Denied' && QuoteStatusValue != 'Deal Reg Approved' && Opp.StageName != 'Deal Registration Approved' && Opp.StageName != 'Deal Reg Auto-Approved' && Opp.StageName != 'Cancelled')}">
                        <label class="greenText">Thank you! Your deal has been registered.</label>
                    </apex:outputPanel>
                    <apex:outputPanel rendered="{!Opp.StageName = 'Cancelled'}">
                        <label style="color:red;">Your deal has been declined. You can modify your order and resubmit.</label>
                        <br/>
                    </apex:outputPanel>
                    <apex:outputPanel rendered="{!QuoteStatusValue = 'Special Pricing Approved'}">
                        <apex:outputLabel value="Special Pricing Status: " />Approved
                        <br/>
                    </apex:outputPanel>
                    <apex:outputPanel rendered="{!QuoteStatusValue = 'Special Pricing Denied'}">
                        <apex:outputLabel value="Special Pricing Status: " />Denied
                        <br/>
                    </apex:outputPanel>
                </div>
            </apex:outputPanel>
            <c:Dealreg_QuoteInfoTable quoteObj="{!quoteObj}"></c:Dealreg_QuoteInfoTable>
            
            <hr class="dividerHr" style="margin: 30px 0 40px -1px;"/>
            
            <apex:outputPanel rendered="{!!isOfflineMode}">
                <apex:outputPanel styleClass="searchSection">
                    <div style="position: relative;float: left;">
                        <span class="dataTableManageCustSearchButton search_button"></span>
                        <input id="searchFieldDealReg" onkeyup="searchSiteListPanelTable();" placeholder="Search by keyword" type="text" style="width:300px;"/>                    
                    </div>
                    <div class="addNewAddressBtn"><apex:commandButton value="Add New Address" action="{!AddAddress}" reRender="addaddresspopup" oncomplete="openAddAddressPop();" status="loading" /></div>
                    <apex:outputText styleClass="totalSitesCount" value="{!custSiteList.size} Site{!IF(custSiteList.size>1,'s','')} Total"></apex:outputText>
                </apex:outputPanel>
                
                <apex:outputPanel styleClass="exportQuoteLinkSection">
                    <span class="tooltipTrigger glyphicon glyphicon-info-sign" data-toggle="tooltip" rel="tooltip" data-placement="top" title="This will export an Excel file based on the filtered results displayed in the table."></span>
                    <apex:commandLink value="Export Quote" onclick="window.open('/apex/quoteInexcelformat?quoteId={!quoteObj.id}'); return false;"/>               
                </apex:outputPanel>                
                
                <apex:outputPanel id="sitelistPanel" styleClass="m-t-20 tableSection">
                    <table class="tableSortingClass table table-bordered" id="tableSortingClass" style="clear:both;">
                        <thead>
                            <tr>
                                <th>Site Name<div class="reorder_btn sortingIcon"></div></th>
                                <th>Site Address<div class="reorder_btn sortingIcon"></div></th>
                                <th>Monthly<div class="reorder_btn sortingIcon"></div></th>
                                <th>One-Time<div class="reorder_btn sortingIcon"></div></th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody>
                            <apex:repeat value="{!custSiteList}" var="site">
                                <tr>
                                    <td>{!site.Site_Name__c}</td>
                                    <td>{!site.Address_Line__c}, {!site.City__c}, {!site.State__c} {!site.Zip_Code__c}</td>
                                    <td>
                                        <apex:outputText value="${0, number, ###,###,##0.00}">
                                            <apex:param value="{!mapSiteTotalPrice[site.id]}" />
                                        </apex:outputText>
                                    </td>
                                    <td>
                                        <apex:outputText value="${0, number, ###,###,##0.00}">
                                            <apex:param value="{!mapSiteTotalOneTime[site.id]}" />
                                        </apex:outputText>                                    
                                    </td>
                                    <td class="nosearch">
                                        <apex:commandLink value="{!$Label.Reconfigure}" action="{!checkReconfigure}" oncomplete="openReConfPop();" rerender="reConfigurePopup" status="loading">
                                            <apex:param value="{!site.id}" assignTo="{!siteConfigureId}" name="pNo" />
                                        </apex:commandLink>
                                        <span> | </span>
                                        <apex:commandLink value="{!$Label.Remove}" status="loading" action="{!checkReconfigure}" reRender="sitelistPanel,price,btnSec,tstpopup" oncomplete="openRemovePop();" >
                                            <apex:param value="{!site.id}" assignTo="{!siteRemoveId}" name="pNo" />
                                        </apex:commandLink>
                                    </td>                                    
                                </tr>
                            </apex:repeat>
                      </tbody>
                 </table>
                </apex:outputPanel>
                <div class="col-xs-12" style="margin-top: 20px;padding:0;">
                   <div style="width:390px;height:138px;float:left;margin-top:80px;margin-left:-5px !important">       
                       <table id="Deal data" class="table1">        
                        <tr>        
                            <td>        
                                <apex:outputPanel rendered="{!LargeDealRebate = true}">     
                                    <label class="dealClass" style="margin-bottom:7px !important">You are eligible for the Large Deal Promotion</label>     
                                </apex:outputPanel>     
                            </td>       
                        </tr>       
                        <tr>        
                            <td>        
                                <apex:outputPanel rendered="{!LargeDealRebate = true}" >        
                                    <label class="dealClass" style="font-size: 8.8pt;line-height: 10.8pt !important; margin-bottom:12px !important;">      
                                        This Pricing Schedule is eligible for a Large Deal Promotion-a bill credit<br/>     
                                        equal to 5%, 10% or 15% of the annual eligible billed charges incurred<br/>      
                                        during the promotion period.Refer to the related Pricing Schedule for<br/>      
                                        Complete details &amp; eligibility.                                     
                                    </label>        
                                </apex:outputPanel>         
                            </td>       
                        </tr>       
                        <tr>        
                            <td>        
                                <apex:outputPanel rendered="{!LargeDealRebate = true}" >        
                                    <label class="dealClass" style="font-size: 6pt;line-height: 8pt;">       
                                        *The Large Deal Promotion bill credit is provided for evaluation purposes only and may not reflect the<br/>     
                                        credit amount.The actual promotional credit is determined by the eligible services installed and<br/>       
                                        and billing during the promotion period.For complete details regarding Large Deal Promotion please<br/>     
                                        refer to your pricing schedule.     
                                    </label>        
                                </apex:outputPanel>         
                            </td>       
                        </tr>       
                      </table>      
                   </div>       
                    <div style="width:500px;" class="pull-right">
                        <div class="f-s-20" style="margin-left: 10px !important;">Quote Pricing Summary</div>
                        <table id="pricingSmryTable" class="table">
                            <tr>
                                <td>Monthly Total</td>
                                <td class="text-right">
                                    <apex:outputText value="${0, number, ###,###,##0.00} /mo">
                                            <apex:param value="{!monthlyInstallationCharges}" />
                                    </apex:outputText> 
                                </td>
                            </tr>
                            <tr class="orangeText">
                                <td>        
                                    <apex:outputPanel rendered="{!showAdditionaldiscSection=true}">     
                                        Additional Discount     
                                    </apex:outputPanel>     
                                </td>       
                                <td class="text-right">
                                    <apex:outputPanel rendered="{!showAdditionaldiscSection=true}"> 
                                        <span>-</span>
                                        <apex:outputText value="${0, number, ###,###,##0.00} /mo">
                                            <apex:param value="{!additionalSPAmount}" />
                                        </apex:outputText> 
                                    </apex:outputPanel>     
                                </td>       
                            </tr>     
                           
                            <tr class="orangeText">                                
                                <td>
                                    <!--id="AddDiscount"-->
                                    <apex:outputPanel rendered="{!dealRegDiscount =true && DealRegistrationAmount!= null && DealRegistrationAmount> 0 && (quoteObj.Apttus_Proposal__Approval_Stage__c = $Label.Quote_Deal_Approved || quoteObj.Apttus_Proposal__Approval_Stage__c = 'Special Pricing Denied')}">
                                        Deal Registration Discount
                                    </apex:outputPanel>
                                    <!--id="SpecialDiscount"-->
                                    <apex:outputPanel rendered="{!specialPricingDiscount =true && specialPricingAmount!= null && specialPricingAmount> 0 && quoteObj.Apttus_Proposal__Approval_Stage__c = $Label.Quote_Special_Pricing_Approved}">
                                        Special Pricing Discount
                                    </apex:outputPanel>
                                </td>
                                <td class="text-right">
                                    <!--id="AddDiscount"-->
                                    <apex:outputPanel rendered="{!dealRegDiscount =true && DealRegistrationAmount!= null && DealRegistrationAmount> 0 && (quoteObj.Apttus_Proposal__Approval_Stage__c = $Label.Quote_Deal_Approved || quoteObj.Apttus_Proposal__Approval_Stage__c = 'Special Pricing Denied')}">
                                        <span>-</span>
                                        <apex:outputText value="${0, number, ###,###,##0.00} /mo">
                                            <apex:param value="{!DealRegistrationAmount}" />
                                        </apex:outputText> 
                                    </apex:outputPanel>
                                    <!--id="SpecialDiscount"-->
                                    <apex:outputPanel rendered="{!specialPricingDiscount =true && specialPricingAmount!= null && specialPricingAmount> 0 && quoteObj.Apttus_Proposal__Approval_Stage__c = $Label.Quote_Special_Pricing_Approved}">
                                        <span>-</span> 
                                        <apex:outputText value="${0, number, ###,###,##0.00} /mo">
                                             <apex:param value="{!specialPricingAmount}" />
                                         </apex:outputText> 
                                    </apex:outputPanel>
                                </td>
                            </tr>
                            <tr>
                                <td><strong><span style="color:black;font-weight: bold;">Monthly Total </span>(discounts applied)</strong></td>
                                <td class="text-right" style="color:black;font-weight: bold;">
                                    <strong>
                                         <apex:outputText value="${0, number, ###,###,##0.00} /mo">
                                             <apex:param value="{!total}" />
                                         </apex:outputText>
                                    </strong>
                                </td>
                            </tr>
                            <tr style="color:black;font-weight: bold;">
                                <td><strong>One-Time Total</strong></td>
                                <td class="text-right">
                                    <strong style="margin-right: 0px;">
                                        <apex:outputText value="${0, number, ###,###,##0.00}">
                                            <apex:param value="{!oneTimeTotal}" />
                                        </apex:outputText>      
                                    </strong> 
                                </td>
                            </tr>
                            <tr>
                                <td colspan="2">
                                    <p style="margin:0;font-size:11px;color:black;padding-top:15px">All prices shown are pre-tax.</p> 
                                </td>
                            </tr>
                            <tr class="f-s-24 potentialClass">      
                                <td style="padding-top:11px ! important">       
                                    <apex:outputPanel rendered="{!LargeDealRebate = true}" >        
                                        Potential Annual Large Deal Bill Credit*        
                                    </apex:outputPanel>     
                                </td>       
                                <td class="text-right" style="padding-top:11px ! important">        
                                    <apex:outputPanel rendered="{!LargeDealRebate = true}" >        
                                        <apex:outputText value="${0, number, ###,###,##0.00}">      
                                            <apex:param value="{!rebateAmount}" />      
                                        </apex:outputText>      
                                    </apex:outputPanel>     
                                </td>       
                            </tr>
                            
                        </table>
                    </div>
                </div>
                <div style="margin-left: 115%;margin-left;margin-top: -82%;">
                    <a href="#" class="scrollToTop arrowImageDim"> <apex:image value="{!($Resource.TopArrow)}" styleClass="arrowImageDim"/></a>
                </div>
                <hr class="dividerHr" style="margin: 0 0 20px 0;clear:both;" />
                <apex:outputPanel id="btnSec">
                    <div class="btn-group pull-right" style="2px solid #d3d3d3;">
                        <apex:commandButton styleclass="btn btn-primary" action="{!SubmitDeal}" value="{!$Label.SubmitQuote}" html-data-toggle="modal" html-data-target="#submitSuccess" reRender="btnSec,sitelistPanel,price" status="loading" rendered="{!isSuccess}" />
                        <apex:commandButton styleclass="btn btn-primary" value="Order Service" style="border:1px solid #939393 !important;border-right:none !important;width: 138px !important; margin: 0; border-top-right-radius: 0 !important; border-bottom-right-radius: 0 !important; padding: 7px 20px !important; color: #fff !important;" action="{!OrderService}" rendered="{!!isSuccess}" />
                        <apex:commandButton styleClass="btn btn-default dropdown-toggle" html-data-toggle="dropdown" value="â–¼" style="border:1px solid #939393 !important;width:40px;margin: 0;border-bottom-left-radius: 0 !important;border-top-left-radius: 0 !important;background: #fff !important;color: #000;" rendered="{!!isSuccess}">
                            <span class="sr-only">Toggle Dropdown</span>
                        </apex:commandButton>
                        <ul class="dropdown-menu blueText" role="menu">
                            <li>
                                <apex:commandLink value="{!$Label.RequestSpecialPricing}" action="{!SpecialPricing}" rendered="{!requestSpclPricingFlag}" />
                            </li>
                            <!--
                            <li role="presentation" class="divider" style="{!IF(requestSpclPricingFlag == false ,'display: none;','')}"></li>
                            <li>
                                <apex:commandLink value="{!$Label.Duplicate_Quote}" action="{!cloneQuote}" />
                            </li>
                            -->
                        </ul>
                    </div>
                    <a class="goToDashboardLink" href="/apex/PortalDashboard_UI">Go to My Dashboard</a>                
                </apex:outputPanel>
            </apex:outputPanel>
            <apex:outputPanel rendered="{!isOfflineMode}">
                <apex:include pageName="offline_BulkProcessing"/>                
            </apex:outputPanel>             
        </apex:outputPanel>
               
        <!-- Pop Up Window-->
        <apex:outputPanel id="tstpopup">
            <div class="modal fade removePop">
                <div class="modal-dialog">
                    <div class="modal-content">
                        <apex:outputPanel styleClass="" layout="block" rendered="{!displayPopUp}" />
                        <apex:outputPanel styleClass="" layout="block" rendered="{!(displayPopUp==True)&&(custSiteList.size>1)&&(quoteObj.Product__r.productcode=='AMIS'||quoteObj.Product__r.productcode=='AVPN' || quoteObj.Product__r.productcode=='AIA')}">
                            <div class="modal-header">
                                <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span>
                                </button>
                                <h4 class="modal-title" id="myModalLabelR2">Remove</h4>
                            </div>
                            <div class="modal-body">
                                <p>
                                    This change may affect discounts on your order. Click <b>Continue</b> to confirm or <b>Cancel</b> to return to the Cart page.
                                </p>
                            </div>
                            <div class="modal-footer">
                                <apex:commandButton styleclass="btn btn-primary" value="Continue" action="{!RemoveAVPNConfiguration}" rerender="reConfigurePopup,sitelistPanel,price,btnSec" status="loading"/>
                                <apex:commandButton styleclass="btn btn-default" value="Cancel" action="{!closePopup}" rerender="reConfigurePopup" html-data-dismiss="modal" />
                            </div>
                        </apex:outputPanel>
                        <apex:outputPanel styleClass="" layout="block" rendered="{!(displayPopUp==True)&&(custSiteList.size==1)&&(quoteObj.Product__r.productcode=='AMIS'||quoteObj.Product__r.productcode=='AVPN' ||quoteObj.Product__r.productcode=='AIA')}">
                            <div class="modal-header">
                                <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span>
                                </button>
                                <h4 class="modal-title" id="myModalLabelR2">Remove</h4>
                            </div>
                            <div class="modal-body">
                                <p>
                                    By removing this Site, you will not have minimum sites required for this configuration. Click <b>Continue</b> to confirm or <b>Cancel</b> to return to the Cart page.
                                </p>
                            </div>
                            <div class="modal-footer">
                                <apex:commandButton styleclass="btn btn-primary" value="Continue" action="{!RemoveAVPNConfiguration}" rerender="reConfigurePopup,sitelistPanel,price,btnSec" status="loading"/>
                                <apex:commandButton styleclass="btn btn-default" value="Cancel" action="{!closePopup}" rerender="reConfigurePopup" html-data-dismiss="modal" />
                            </div>
                        </apex:outputPanel>
                        <apex:outputPanel styleClass="" layout="block" rendered="{!(quoteObj.Ethernet_Configuration__c=='Ethernet Private Line (Point-to-Point)')&&(displayPopUp==True)&&(quoteObj.Product__r.productcode=='ASES')}">
                            <div class="modal-header">
                                <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span>
                                </button>
                                <h4 class="modal-title" id="myModalLabelR1">Remove</h4>
                            </div>
                            <div class="modal-body">
                                <p>
                                    By removing this site you will not have the minimum sites required for this configuration. If you want to proceed, choose one of the options below and click <b>Continue.</b>
                                </p>
                                <apex:selectRadio value="{!selectedRemoveValue}">
                                    <apex:selectOption itemValue="Remove this Site and Add a New Site" itemlabel="Remove this Site and Add a New Site" />
                                    <apex:selectOption itemValue="Delete this quote and return to Dashboard" itemlabel="Delete this quote and return to Dashboard" />
                                </apex:selectRadio>
                            </div>
                            <div class="modal-footer">
                                <apex:commandButton styleclass="btn btn-primary" value="Continue" action="{!RemoveASEConfiguration}" rerender="tstpopup,sitelistPanel,price,btnSec" status="loading"/>
                                <apex:commandButton styleclass="btn btn-default" value="Cancel" action="{!closePopup}" rerender="tstpopup" html-data-dismiss="modal" />
                            </div>
                        </apex:outputPanel>
                        <apex:outputPanel styleClass="" layout="block" rendered="{!(quoteObj.Ethernet_Configuration__c=='Ethernet Virtual Private Line (Hub-and-Spoke)')&&(displayPopUp==True)&&(custSiteList.size>3)&&(quoteObj.Product__r.productcode=='ASES')}">
                            <div class="modal-header">
                                <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span>
                                </button>
                                <h4 class="modal-title" id="myModalLabelR2">Remove</h4>
                            </div>
                            <div class="modal-body">
                                <p>
                                    By removing this site you will not have the minimum sites required for this configuration. If you want to proceed,choose one of the options below and click <b>Continue.</b>
                                </p>
                            </div>
                            <apex:selectRadio styleclass="removeQuoteModalSelect" value="{!selectedRemoveValue}">
                                <apex:selectOption itemValue="Remove this Site and Add a New Site" itemlabel="Remove this Site and Add a New Site" />
                                <apex:selectOption itemValue="Remove the Site" html-name="removeQuoteModalSelect" itemlabel="Remove the Site" />
                                <apex:selectOption itemValue="Delete this quote and return to Dashboard" itemlabel="Delete this quote and return to Dashboard" html-name="removeQuoteModalSelect" />
                            </apex:selectRadio>
                            <div class="modal-footer">
                                <apex:commandButton styleclass="btn btn-primary" value="Continue" action="{!RemoveASEConfiguration}" rerender="reConfigurePopup,sitelistPanel,price,btnSec" status="loading"/>
                                <apex:commandButton styleclass="btn btn-default" value="Cancel" action="{!closePopup}" rerender="reConfigurePopup" html-data-dismiss="modal" />
                            </div>
                        </apex:outputPanel>
                        <apex:outputPanel styleClass="" layout="block" rendered="{!(quoteObj.Ethernet_Configuration__c=='Ethernet Virtual Private Line (Hub-and-Spoke)')&&(displayPopUp==True)&&(custSiteList.size==3)&&(quoteObj.Product__r.productcode=='ASES')}">
                            <div class="modal-header">
                                <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span>
                                </button>
                                <h4 class="modal-title" id="myModalLabelR3">Remove</h4>
                            </div>
                            <div class="modal-body">
                                <p>By removing this site you will not have the minimum sites required for this configuration. If you want to proceed,choose one of the options below and click <b>Continue.</b>
                                </p>
                                <apex:selectRadio value="{!selectedRemoveValue}">
                                    <apex:selectOption itemValue="Remove this Site and Add a New Site" itemlabel="Remove this Site and Add a New Site" />
                                    <apex:selectOption itemValue="Change network product configuration to point-to-point" itemlabel="Change network product configuration to point-to-point" />
                                    <apex:selectOption itemValue="Delete this quote and return to Dashboard" itemlabel="Delete this quote and return to Dashboard" />
                                </apex:selectRadio>
                            </div>
                            <div class="modal-footer">
                                <apex:commandButton styleclass="btn btn-primary" value="Continue" action="{!RemoveASEConfiguration}" rerender="reConfigurePopup,sitelistPanel,price,btnSec" status="loading"/>
                                <apex:commandButton styleclass="btn btn-default" value="Cancel" action="{!closePopup}" rerender="reConfigurePopup" html-data-dismiss="modal" />
                            </div>
                        </apex:outputPanel>
                    </div>
                </div>
                <!-- /.modal-dialog -->
            </div>
            <!-- /.modal -->
        </apex:outputPanel>
        <!--End of Pop Up Window-->

        <!-- Pop Up Window-->
        <div class="modal fade reconfigure">
            <div class="modal-dialog">
                <div class="modal-content">
                    <apex:outputPanel id="reConfigurePopup">
                        <apex:outputPanel styleClass="" layout="block" rendered="{!(displayPopUp==True)&&(quoteObj.Product__r.productcode=='ASES')}">
                            <div class="modal-header">
                                <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span>
                                </button>
                                <h4 class="modal-title" id="myModalLabel">Change Product Network Configuration</h4>
                            </div>
                            <div class="modal-body">
                                <p>You can change your network configuration to point-to-point,any-to-any or hub-and-spoke.If you choose to proceed,this step will delete all Ethernet Virtual Connections you have created and you will have to reconfigure your sites
                                </p>
                                <p>
                                    Clicking <b>Continue</b> will navigate you to the Change Network Configuration page.Do you want to continue?
                                </p>
                            </div>
                            <div class="modal-footer">
                                <apex:commandButton styleClass="btn btn-primary" value="Continue" action="{!Reconfigure}" rerender="reConfigurePopup,sitelistPanel,price,btnSec" status="loading"/>
                                <apex:commandButton styleClass="btn btn-default" html-data-dismiss="modal" value="Cancel" action="{!closePopup}" rerender="reConfigurePopup" />
                            </div>
                        </apex:outputPanel>
                        <apex:outputPanel styleClass="" layout="block" rendered="{!(displayPopUp==True)&&(quoteObj.Product__r.productcode=='AMIS'||quoteObj.Product__r.productcode=='AVPN' ||quoteObj.Product__r.productcode=='AIA')}">
                            <div class="modal-header" style="border: 0;">
                                <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span>
                                </button>
                                <h4 class="modal-title" id="myModalLabel">Change Product Network Configuration</h4>
                            </div>
                            <div class="modal-body" style="padding-top: 0;">
                                <p class="text-center" style="line-height: 1.5em">
                                    This change may affect discounts on your order.
                                    <br />Click <b>Continue</b> to confirm or <b>Cancel</b> to return to the Cart page.
                                </p>
                            </div>
                            <div class="modal-footer" style="border: 0;">
                                <apex:commandButton styleClass="btn btn-primary" value="Continue" action="{!Reconfigure}" rerender="reConfigurePopup,sitelistPanel,price,btnSec" style="padding: 7px 20px !important;" status="loading"/>
                                <apex:commandButton styleClass="btn btn-default" html-data-dismiss="modal" value="Cancel" action="{!closePopup}" rerender="reConfigurePopup" style="padding: 7px 20px !important;" />
                            </div>
                        </apex:outputPanel>
                    </apex:outputPanel>
                </div>
            </div>
            <!-- /.modal-dialog -->
        </div>
        <!-- /.modal -->
        <div class="modal fade addAddress">
            <div class="modal-dialog">
                <div class="modal-content">
                    <apex:outputPanel id="addaddresspopup">
                        <apex:outputPanel styleClass="" layout="block" rendered="{!(AddAdress)&&(quoteObj.Product__r.productcode=='AMIS'||quoteObj.Product__r.productcode=='AVPN' ||quoteObj.Product__r.productcode=='AIA')}">
                            <div class="modal-header" style="border: 0;">
                                <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span>
                                </button>
                                <h4 class="modal-title" id="myModalLabelR2"></h4>
                            </div>
                            <div class="modal-body text-center">
                                <p>
                                    This change may affect discounts on your order.
                                    <br />Click <b>Continue</b> to confirm or <b>Cancel</b> to return to the Cart page.
                                </p>
                            </div>
                            <div class="modal-footer text-center" style="border: 0;">
                                <div style="width: 200px; text-center; margin: 0 auto;">
                                    <apex:commandButton styleclass="btn btn-primary" value="Continue" action="{!GotoAddAddressPage}" rerender="reConfigurePopup,sitelistPanel,price,btnSec" status="loading" style="padding: 7px 12px !important;" />
                                    <apex:commandButton styleclass="btn btn-default" value="Cancel" action="{!closePopup}" rerender="reConfigurePopup" html-data-dismiss="modal" style="padding: 7px 20px !important;" />
                                </div>
                            </div>
                        </apex:outputPanel>
                        <apex:outputPanel styleClass="" layout="block" rendered="{!(AddAdress)&&(quoteObj.Product__r.productcode=='ASES')&&(quoteObj.Ethernet_Configuration__c=='Ethernet Virtual Private Line (Hub-and-Spoke)')}">
                            <div class="modal-header">
                                <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span>
                                </button>
                                <h4 class="modal-title" id="myModalLabelR2"></h4>
                            </div>
                            <div class="modal-body">
                                <p>You can change your network configuration to point-to-point,any-to-any or hub-and-spoke.If you choose to proceed,this step will delete all Ethernet Virtual Connections you have created and you will have to reconfigure your sites
                                </p>
                                <p>
                                    Clicking <b>Continue</b> will navigate you to the Change Network Configuration page.Do you want to continue ?
                                </p>
                            </div>
                            <div class="modal-footer">
                                <apex:commandButton styleclass="btn btn-primary" value="OK" action="{!GotoAddAddressPage}" rerender="reConfigurePopup,sitelistPanel,price,btnSec" />
                                <apex:commandButton styleclass="btn btn-default" value="Cancel" action="{!closePopup}" rerender="reConfigurePopup" html-data-dismiss="modal" />
                            </div>
                        </apex:outputPanel>
                        <apex:outputPanel styleClass="" layout="block" rendered="{!(AddAdress)&&(quoteObj.Product__r.productcode=='ASES')&&(quoteObj.Ethernet_Configuration__c=='Ethernet Private Line (Point-to-Point)')}">
                            <div class="modal-header" style="border: 0;">
                                <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span>
                                </button>
                                <h4 class="modal-title" id="myModalLabelR2"></h4>
                            </div>
                            <div class="modal-body">
                                <p>If you add another Site, your configuration will change to Hub and Spoke
                                </p>
                                <p>
                                    Clicking <b>Continue</b> will navigate you to the Add Address page.Do you want to continue ?
                                </p>
                            </div>
                            <div class="modal-footer" style="border: 0;">
                                <apex:commandButton styleclass="btn btn-primary" value="OK" action="{!GotoAddAddressPage}" rerender="reConfigurePopup,sitelistPanel,price,btnSec" style="padding: 7px 20px;" />
                                <apex:commandButton styleclass="btn btn-default" value="Cancel" action="{!closePopup}" rerender="reConfigurePopup" html-data-dismiss="modal" style="padding: 7px 20px;" />
                            </div>
                        </apex:outputPanel>
                    </apex:outputPanel>
                </div>
            </div>
            <!-- /.modal-dialog -->
        </div>
        <!-- /.modal -->
        <!--End of Pop Up Window-->
        <apex:actionFunction id="funcId" action="{!handleQuoteReview}" name="handleQuoteReview" reRender="RegDealFormId,SpclPricingId" status="loading">
            <apex:param name="quoteId" value="" />
            <apex:param name="intervalTime" value="" />
        </apex:actionFunction>
        <apex:actionFunction action="{!Upload}" name="callUpload" status="loading" />
        <apex:actionFunction name="callperformRateRefresh" action="{!performRateRefresh}" rerender="BatchPanel" onComplete="isBatchCompleted();" status="loading" />
        <apex:actionFunction name="checkBatchStatus" action="{!rateRefreshBatchStatus}" rerender="BatchPanel" onComplete="isBatchCompleted();" status="loading" />
    </apex:form>

    <!-- Rate Card Update Modal-->
    <div class="modal fade" id="RatecardUpdateModal" role="dialog" data-backdrop="static">
        <div class="modal-dialog" style="width:700px;">                      
            <div class="modal-content" style="margin-top: 25%;text-align:center;line-height: 22px;">
                <div style="margin-top: 25px;margin-bottom:10px;"><h3 class="modal-header">New Rates</h3></div>  
                <div class="modal-body" style="padding: 25px 25px !important;border-top:2px solid #d1d1d1;">
                    <div>Effective {!$Label.Effective_Rate_Card_Date}, rate cards have been updated for this product. </div>
                    <div>Click <span style="font-weight:bold">Okay</span> to apply the current rates.</div><br/>
                    <div>Please note: Special pricing applied prior to the rate refresh will be removed.</div>
                    <div>You may resubmit for approval, if needed.</div><br/>
                    <div>You can view the updated rate card on the product page.</div>
                </div>
                <div class="modal-footer" style="padding: 10px 25px 40px;">
                   <button type="button" class="btn--primary" data-dismiss="modal" aria-hidden="true" style="width: 115px !important;padding: 8px 10px !important;" onClick="$('#RatecardUpdateModal').modal('hide');callperformRateRefresh();">Okay</button>
                </div>
            </div>
        </div>
    </div>  
    <apex:outputPanel id="BatchPanel">
        <script>
            function isBatchCompleted(){
                var pollingvar = '{!doBatchPolling}';
                if (pollingvar == 'true') {
                    checkBatchStatus();
                }else{
                    location.reload();
                }
            } 
        </script>
    </apex:outputPanel>       
    <script type="text/javascript">
        function sortTable(table, col, reverse) {
            var tb = table.tBodies[0], // use `<tbody>` to ignore `<thead>` and `<tfoot>` rows
                tr = Array.prototype.slice.call(tb.rows, 0), // put rows into array
                i;
            reverse = -((+reverse) || -1);
            tr = tr.sort(function (a, b) { // sort rows
                return reverse // `-1 *` if want opposite order
                    * (a.cells[col].textContent.trim() // using `.textContent.trim()` for test
                        .localeCompare(b.cells[col].textContent.trim())
                       );
            });
            for(i = 0; i < tr.length; ++i) tb.appendChild(tr[i]); // append each row in order
        }
        
        function makeSortable(table) {
            var th = table.tHead, i;
            th && (th = th.rows[0]) && (th = th.cells);
            if (th) i = th.length;
            else return; // if no `<thead>` then do nothing
            while (--i >= 0) (function (i) {
                var dir = 1;
                if(i != 4){
                    th[i].childNodes[1].addEventListener('click', function () {sortTable(table, i, (dir = 1 - dir))});
                }
            }(i));
        }
        
        function makeAllSortable(parent) {
            parent = parent || document.body;
            var t = parent.getElementsByClassName('tableSortingClass');
            makeSortable(t[0]);
        }
    
        jQuery(document).ready(function($){
            $("body").tooltip({ selector: '[rel=tooltip]' });
            $(".tooltipTrigger").tooltip(); 
            if({!eligibleRateRefresh}){
                $('#successMsgSection').css('display','none');
                $('#RatecardUpdateModal').modal('show');
            } 
           
            jQuery.extend( jQuery.fn.dataTableExt.oSort, {
            "currency-pre": function ( a ) {
                a = (a==="-") ? 0 : a.replace( /[^\d\-\.]/g, "" );
                return parseFloat( a );
            },
         
            "currency-asc": function ( a, b ) {
                return a - b;
            },
         
            "currency-desc": function ( a, b ) {
                return b - a;
            }
        } ); 
            $('#tableSortingClass').DataTable({
                "columnDefs": [{ type: 'currency', targets: 2 }],
                "aaSorting": [[ 2, 'asc' ]],
                "bPaginate": false,
                "bFilter": false,
                "bInfo": false
                
            });         
            setTimeout(function(){ makeAllSortable(); }, 2000);
            $(window).scroll(function(){
                if ($(this).scrollTop() > 100) {
                    $('.scrollToTop').fadeIn();
                } else {
                    $('.scrollToTop').fadeOut();
                }
            });
            $('.scrollToTop').click(function(){
                $('html, body').animate({scrollTop : 0},500);
                return false;
            }); 
        });

        function searchSiteListPanelTable(){
            var searchValue = $('#searchFieldDealReg').val();           
            $(".tableSection tbody").find('tr').each(function(index, row){
                var allCells = $(row).find('td:not(:last-child)');
                if(allCells.length > 0){
                    var found = false;
                    allCells.each(function(index, td){
                        var regExp = new RegExp(searchValue, 'i');
                        if(regExp.test($(td).text())){
                            found = true;
                            return false;
                        }
                    });
                    if(found == true)$(row).show();else $(row).hide();
                    
                    if($(".tableSection tbody").find('tr:visible').length == 0){
                        var errorMsg = $('<tr class="noSearchDataAvailable"><td colspan="5">No data available in table</td></tr>');                                    
                        $(".tableSection tbody").append(errorMsg);
                        return false;
                    }else{
                        $(".tableSection tbody").find('.noSearchDataAvailable').remove();
                    }                    
                }
            });
        }       
   
        function openRemovePop() {
            $('.removePop').modal();
        }

        function openReConfPop() {
            $('.reconfigure').modal();
        }

        function openAddAddressPop() {
            $('.addAddress').modal();
        }

        function setMode() {
            mode = '';
        }

        function exportquote() {
            var quoteId = '{!$CurrentPage.parameters.quoteid}';
            var mode = 'regdeal';
            var intervalTime = '{!$CurrentPage.parameters.intervalTime}';
            window.open('{!$Page.quoteInExcelFormat}?mode=' + mode + '&intervalTime=' + intervalTime + '&quoteId=' + quoteId, '_blank');
        }

        function isReviewSelected() {
            $('a[data-name="submitOrderTab"]').parent('li').removeClass('disabled');
            $('a[data-name="submitOrderTab"]').attr({
                'data-toggle': "tab",
                href: "#submitOrderTab"
            });
            $("a[data-name='submitOrderTab']").trigger("click");
        }
    </script>
</apex:page>