<apex:page controller="submitOrderController" standardStylesheets="false" sidebar="false" showHeader="false" tabStyle="Apttus_Proposal__Proposal__c" docType="html-5.0" applyHtmlTag="false" applyBodyTag="false">
<apex:includescript value="//cdn.datatables.net/1.10.11/js/jquery.dataTables.min.js" />
<apex:includescript value="//cdn.datatables.net/plug-ins/1.10.11/features/searchHighlight/dataTables.searchHighlight.min.js" />
<apex:includescript value="//cdnjs.cloudflare.com/ajax/libs/jszip/2.5.0/jszip.min.js" />
<apex:includescript value="//cdnjs.cloudflare.com/ajax/libs/jspdf/1.3.2/jspdf.min.js" />
<apex:includescript value="//cdnjs.cloudflare.com/ajax/libs/html2canvas/0.4.1/html2canvas.min.js" />
<apex:includeScript value="{!$Resource.downloadJS}"/>
  <style>
        .thankYouLabel{
            font-family:omnes_att_iimedium;
            font-size:18px;
            margin-top: 36px;
            margin-bottom: 25px !important;
        }
        .alignDashboardLinkMT{
            margin-top:3%;
            width:100%;
        }
        .attLinkBlue{
        color: #0568ad!important;
        font-family: omnes_att_iimedium;
        font-size: 16px;
        line-height: 12px !important;
        }
        .attLinkBlue:hover{
        color: #3bc1f4 !important;
        }
        .alignDashboardLinkMB{
            float:right;
        }
        .m-t-15 {
            margin-top:15px;
        }
        .m-t-25{
            margin-top:25px;
        }
        .confirmPara {
            font-size:18px;
            font-family:omnes_light;
            font-weight:bold;
        }
        .tableDataSection .table a {
            color: #009edb !important;
            font-family: omnes_att_iimedium;
            font-size: 16px!important; 
        }
        .tableDataSection thead{
            color: #009edb;
        }
        .tableDataSection table{
            border-color: #939393 !important;
        }        
        .tableDataSection .table-bordered>thead>tr>th{
            border-bottom: 1px dashed #939393;
            border-left-color: #939393;
            border-right-color: #939393;
        }
        .tableDataSection .table-bordered>tbody.custTable>tr>td{
            border:none !important;
        }
        .tableDataSection .table>tbody.custTable>tr>td{
            border-top: 1px dashed #939393 !important;
            border-right: 1px solid #939393 !important;
        }        
        .sitesDataTable {
            width: 100% !important;
            font-family: omnes_att_iimedium;
        }
        .sitesDataTable.table-bordered>tbody.custTable>tr>td{
            border:none;
            font-size:16px;
            white-space:nowrap;
        }
        .sitesDataTable.table>tbody.custTable>tr>td{
            border-top: 1px dashed #ddd;
            border-right: 1px solid #d3d3d3;
        }
        .sitesDataTable thead th .reorder_btn {
            display: block;
            position: relative;
            float: right;
            top: 5px;
        }
        #sitesTable thead {
            background-color: white;
        }
        .sitesDataTable thead th:nth-child(5) div.reorder_btn {
            display: none;
        }
        .tableDataSection .table>tbody.custTable>tr>td.putDollarSign{
            font-size: 16px;
            text-align: right;
            white-space: nowrap;
        }
        .tableDataSection .table>tbody.custTable>tr>td.highlightPriceUpdate{
            font-size: 16px;
            white-space: nowrap;
            background: #ea740070 !important;
        }
         .tableDataSection .table a.disabled{
            color: #939393 !important;
            pointer-events: none !important;
            cursor: default !important;
        }
        .wprulesdiv{
            max-width: 284px;
            position: relative;
            margin-top: 10px;
            border-top: 1px dashed #939393;
        }
        span.quoteSummaryTitle{
            font-size: 28px !important;
            font-weight: 700;
            font-family: omnes_light;
        }
        .table.subTotalSummary{
            margin-bottom: 8px !important;
            margin-top: 20px;
        }
        #pricingSmryTable td {
            border: 0px;
        }
        table#pricingSmryTable {
            border-spacing: 10px;
            border-collapse: inherit;
            margin-top: 20px;
            margin-bottom: -3px;
        }
        .additionalDiscount{
            color:#ea7200;
            font-weight: 700;           
        }
        .grey_hr{
            border-bottom:1px solid #000;
            height: 1px;
            background: #000;
            margin-left: 10px;
            margin-bottom: -11px;
            margin-top: 8px;
        }
        .orangeText{
            color: #ea7400 !important;
            font-family: omnes_att_iimedium !important;;
        }
        .pricingSummarydiv{
            margin-top: 15px;
            padding: 0;
            margin-bottom: -55px;
        }
        div.promotionAppliedData h5{
            font-family: omnes_att_iimedium;
            font-size: 18px;
        }
        table.promoTable td{
            padding: 2px 0px;
            white-space: nowrap;
            font-size: 14px;
            line-height: 1.2em;
            font-family: omnes_light;
            background: #fff;
            font-weight: 700 !important;
        }
         table.promoTable td:nth-child(2){
            color: #ea7400 !important;
        }        
        table.promoTable td:last-child{
            color: red !important;
            font-size: 10px;
            padding: 5px 10px;
            vertical-align: top;
        }
         table.promoTable td:first-child{           
            width:200px !important;
            max-width: 200px;
            text-overflow: ellipsis;
            overflow: hidden;
            padding: 0 0px;
        }
        .promotionAppliedData{
            display:none;
            background: #fff;
            border: 1px solid #ccc;
            padding: 10px;
            margin-left: 10px;
            margin-bottom: 24px;
        }
        .promotionAppliedData h5{
            margin-bottom: 10px;
        }
        .quoteSummaryDiv{
            top: 13px;
        }
        .boldFont{
            font-weight: bold;
        }
        .boldFont{
            font-weight: bold;
        }
        /*table.sitesDataTable tbody tr:nth-child(odd), table.sitesDataTable tbody:not(tr.sitePromotion){
            background-color: #f2f2f2;
        }
        table.sitesDataTable tbody tr:nth-child(even),table.sitesDataTable tbody:not(tr.sitePromotion){
            background-color: #ffffff !important;
        }*/
        table.sitesDataTable tbody tr.odd .sitePromotion, table.sitesDataTable tbody tr.odd{
            background-color: #f2f2f2 !important;
            white-space: inherit;
        }
        table.sitesDataTable tbody tr.even .sitePromotion,table.sitesDataTable tbody tr.even{
            background-color: #fff !important;
            white-space: inherit;
        }
        .scrollToTop{ padding:10px; text-align:center; font-weight: bold; color: #444; text-decoration: none; position:fixed; top:80%; right:30px; display:none; .background: url(url('!$Resource.scrollTop') no-repeat center;) no-repeat 0px 20px; width:72px; height:106px; z-index: 9999; }    
         .scrollToTop:hover{
            text-decoration:none;
        }
        .greenStyle{
            color: #007a3e !important;
        }
        table.sitesDataTable>tbody>tr.sitePromotion>td.sitePromotion:hover{
            background: #f5f5f5 !important;
        }
        table.sitesDataTable>tbody>tr>td:first-child:not(.sitePromotion) {
            max-width: 10px !important;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
            width:20%;
            color : #009edb !important;
        }
        table#sitesTable tbody tr td:nth-child(2) {
            max-width: 400px !important;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
        }
        .greenTextStyle{
            color: #007a3d !important;
        }
    </style>
    
    <apex:form >
        <div class="row m0 m-t-20" style="margin-top: 20px;">
            <div class="col-xs-12 col-md-12 p0">
                <apex:outputPanel rendered="{!avpnOrMisDeal}">
                    <h3 style="font-family: omnesatt_iiregular;font-size: 35px">
                        <apex:outputText value="Terms & Conditions" />
                    </h3>
                </apex:outputPanel>
                <h3 class="m-b-10" style="margin: 30px 0px;">
                    <apex:outputText id="cnameheader" value="{!quoteObj.End_Customer__r.Name}" />
                </h3>             
                <div class="row p0" style="margin-top: 10px;margin-bottom: 4px;">
                    <div class="col-xs-3 p0">
                        <label style="margin-right: 10px !important;font-weight: 700;"><apex:outputText value="Quote Name" /></label>
                        <apex:outputText value="{!quoteObj.Apttus_Proposal__Proposal_Name__c}" />
                    </div>
                    <div class="col-xs-3 p0">
                        <label style="margin-right: 10px !important;font-weight: 700;"><apex:outputText value="Quote ID" /></label>
                        <apex:outputText value="{!quoteObj.Name}" />
                    </div>
                    <div class="col-xs-4 p0">
                        <label style="margin-right: 10px !important;font-weight: 700;"><apex:outputText value="Product" /></label>
                        <apex:outputText value="{!quoteObj.Product_New_Name__c}" />
                    </div>
                    <div class="col-xs-2 p0">
                           <span class="pull-right"><apex:outputText value="{!quoteObj.Apttus_Proposal__Payment_Term__c}" /></span>
                           <label class="pull-right" style="margin-right: 10px !important;font-weight: 700;"><apex:outputText value="Term" /></label>
                    </div>
                </div>
            </div>
        </div>     
        
        <div class="p20" id="isConfirmationOpen">
            <hr class="dividerHr" style="margin-top: 20px; margin-bottom: 20px;"/>
            <div style="margin-bottom: 992px;">               
                <apex:outputPanel rendered="{!showDenialReason && !AIAProduct}">
                    <p class="greenText f-s-xxl thankYouLabel">
                        {!$Label.BuyFlow_Denial_ThankYou}
                    </p>
                    <p class="m-t-10" style="font-size:18px;font-family:omnes_att_iimedium;margin-bottom:85%;">
                        {!$Label.BuyFlow_Denial_Para}
                     </p>
                </apex:outputPanel>
                
                 <apex:outputPanel rendered="{!isApprover && !showDenialReason && !AIAProduct}">   
                    <p class="greenText f-s-xxl thankYouLabel greenStyle">
                        {!$Label.Thank_you_for_your_order}
                    </p>
                    <p class="m-t-10" style="font-size:18px;font-family:omnes_att_iimedium;">
                        <apex:outputLabel value="{!$Label.Confirmation_2}"></apex:outputLabel>
                        </p>
                    <apex:outputPanel rendered="{!avpnOrMisDeal}">
                    <p class="m-t-10 m0" style="font-size:18px;font-family:omnes_att_iimedium;padding-top: 5px;">
                        <apex:outputLabel value="{!$Label.Confirmation_4}" style="margin-bottom: 36px !important;"></apex:outputLabel>
                    </p>
                    <apex:outputPanel id="sitelistPanel" styleClass="m-t-20 tableDataSection">
                        <table id="sitesTable" class="sitesDataTable table table-bordered table-hover" style="clear:both;"> <!-- pls don't remove, hack for firefox to make it happy :) -->
                            <thead style="font-size: 17px;">
                                <tr>
                                    <th>Site Name<div class="reorder_btn"></div></th>
                                    <th style="min-width:250px;">Site Address<div class="reorder_btn"></div></th>
                                    <th style="min-width:200px;"><div class="col-xs-9 p0">{!$Label.Monthly}</div><div class="reorder_btn"></div></th>
                                    <th>One-Time<div class="reorder_btn"></div></th>                       
                                </tr>
                            </thead>
                            <tbody class="custTable">
                                <apex:variable var="counter" value="{!0}" />
                                <apex:repeat value="{!custSiteList}" var="site">
                                    <tr class="row_{!counter}">
                                        <td>
                                            <a title="{!site.Site_Name__c}">{!site.Site_Name__c}</a>
                                            <apex:outputPanel rendered="{!IF(siteIdPromoListFinalMap[site.id] != null, true,false)}">
                                                <apex:repeat value="{!siteIdPromoListFinalMap[site.id]}" var="promoObj">
                                                    <div class='hidden promotionAppliedForSite' >
                                                        <apex:variable var="ruleSize" value="{!0}"/>
                                                        <apex:repeat value="{!siteIdPromoListFinalMap[site.id]['Port']}" var="rule">
                                                            <apex:variable var="ruleSize" value="{!ruleSize  + 1}"/>
                                                        </apex:repeat>
                                                        <apex:outputPanel rendered="{!IF(ruleSize > 0, true,false)}">
                                                            <apex:variable var="promoCounter" value="{!0}" />
                                                            <p><span class="boldFont">Port Promotions:</span> 
                                                                <apex:repeat value="{!siteIdPromoListFinalMap[site.id]['Port']}" var="sitePromoData">
                                                                    <apex:outputPanel rendered="{!IF(promoCounter>1,true,false)}">,&nbsp;</apex:outputPanel>
                                                                    <span>{!sitePromoData.Promotion_Name__c} </span>
                                                                    <apex:outputText value=" - {0, number, 0.##}%">
                                                                    <apex:param value="{!sitePromoData.Discount_Percentage__c}" />
                                                                    </apex:outputText> 
                                                                    <apex:variable var="promoCounter" value="{!promoCounter+1}" />
                                                                </apex:repeat>
                                                            </p>
                                                        </apex:outputPanel>
                                                        <apex:variable var="ruleSize" value="{!0}"/>
                                                        <apex:repeat value="{!siteIdPromoListFinalMap[site.id]['Access']}" var="rule">
                                                            <apex:variable var="ruleSize" value="{!ruleSize  + 1}"/>
                                                        </apex:repeat>
                                                        <apex:outputPanel rendered="{!IF(ruleSize > 0, true,false)}">
                                                            <apex:variable var="promoCounter" value="{!0}" />
                                                            <p><span class="boldFont">Access Promotions:</span>
                                                                <apex:repeat value="{!siteIdPromoListFinalMap[site.id]['Access']}" var="sitePromoData">
                                                                    <apex:outputPanel rendered="{!IF(promoCounter>0,true,false)}">,&nbsp;</apex:outputPanel>
                                                                    <span>{!sitePromoData.Promotion_Name__c} </span>
                                                                    <apex:outputText value=" - {0, number, 0.##}%">
                                                                    <apex:param value="{!sitePromoData.Discount_Percentage__c}" />
                                                                    </apex:outputText> 
                                                                    <apex:variable var="promoCounter" value="{!promoCounter+1}" />
                                                                </apex:repeat>
                                                            </p>
                                                        </apex:outputPanel>
                                                        <apex:variable var="ruleSize" value="{!0}"/>
                                                        <apex:repeat value="{!siteIdPromoListFinalMap[site.id]['Feature']}" var="rule">
                                                            <apex:variable var="ruleSize" value="{!ruleSize  + 1}"/>
                                                        </apex:repeat>
                                                        <apex:outputPanel rendered="{!IF(ruleSize > 0, true,false)}">
                                                            <apex:variable var="promoCounter" value="{!0}" />
                                                            <p><span class="boldFont">Feature Promotions:</span>
                                                                <apex:repeat value="{!siteIdPromoListFinalMap[site.id]['Feature']}" var="sitePromoData">
                                                                <apex:outputPanel rendered="{!IF(promoCounter>0,true,false)}">,&nbsp;</apex:outputPanel>
                                                                    <span>{!sitePromoData.Promotion_Name__c} </span>
                                                                    <apex:outputText value=" - {0, number, 0.##}%">
                                                                    <apex:param value="{!sitePromoData.Discount_Percentage__c}" />
                                                                    </apex:outputText> 
                                                                    <apex:variable var="promoCounter" value="{!promoCounter+1}" />          
                                                                </apex:repeat>
                                                            </p>
                                                        </apex:outputPanel>
                                                        <apex:variable var="ruleSize" value="{!0}"/>
                                                        <apex:repeat value="{!siteIdPromoListFinalMap[site.id]['One Time']}" var="rule">
                                                            <apex:variable var="ruleSize" value="{!ruleSize  + 1}"/>
                                                        </apex:repeat>
                                                        <apex:outputPanel rendered="{!IF(ruleSize > 0, true,false)}">
                                                            <apex:variable var="promoCounter" value="{!0}" />
                                                            <p><span class="boldFont">One-Time Promotions:</span> 
                                                                <apex:repeat value="{!siteIdPromoListFinalMap[site.id]['One Time']}" var="sitePromoData">
                                                                <apex:outputPanel rendered="{!IF(promoCounter>0,true,false)}"> -</apex:outputPanel>
                                                                    <span>{!sitePromoData.Promotion_Name__c} </span>
                                                                    <apex:outputText value=" - {0, number, 0.##}%">
                                                                    <apex:param value="{!sitePromoData.Discount_Percentage__c}" />
                                                                    </apex:outputText>
                                                                    <apex:variable var="promoCounter" value="{!promoCounter+1}" />      
                                                                </apex:repeat>
                                                            </p>
                                                        </apex:outputPanel>
                                                    </div>                                              
                                                </apex:repeat>  
                                            </apex:outputPanel>
                                        </td>
                                        <apex:variable value="{!IF((site.Location__c!='' &&  site.Location__c!=null && site.RoomBuildingFloorInput__c!='' && site.RoomBuildingFloorInput__c!=null),' '+site.Location__c+' '+site.RoomBuildingFloorInput__c+',','')}{!IF(((site.Location__c=''||site.Location__c=null)&&(site.RoomBuildingFloorInput__c!=''&&site.RoomBuildingFloorInput__c!=null)),' '+site.RoomBuildingFloorInput__c+',','')}{!IF(((site.Location__c!=''&&site.Location__c!=null)&&(site.RoomBuildingFloorInput__c=''||site.RoomBuildingFloorInput__c=null)),' '+site.Location__c+',','')}" var="titleVar"/>
                                        <td title="{!site.Address_Line__c},{!titleVar} {!site.City__c}, {!site.State__c} {!site.Zip_Code__c}">{!site.Address_Line__c},
                                        <apex:outputPanel rendered="{!IF((site.Location__c!=''&&site.Location__c!=null&&site.RoomBuildingFloorInput__c!=''&&site.RoomBuildingFloorInput__c!=null),true,false)}">
                                            <span>{!site.Location__c} {!site.RoomBuildingFloorInput__c},</span>
                                        </apex:outputPanel>
                                        <apex:outputPanel rendered="{!IF(((site.Location__c=''||site.Location__c=null)&&(site.RoomBuildingFloorInput__c!=''&&site.RoomBuildingFloorInput__c!=null)),true,false)}">
                                            <span>{!site.RoomBuildingFloorInput__c},</span>
                                        </apex:outputPanel>
                                        <apex:outputPanel rendered="{!IF(((site.Location__c!=''&&site.Location__c!=null)&&(site.RoomBuildingFloorInput__c=''||site.RoomBuildingFloorInput__c=null)),true,false)}">
                                            <span>{!site.Location__c},</span>
                                        </apex:outputPanel>
                                        {!site.City__c}, {!site.State__c} {!site.Zip_Code__c}
                                        </td>
                                        <td class="putDollarSign">
                                            <apex:outputText value="${0, number, ###,###,##0.00}">
                                                <apex:param value="{!mapSiteTotalPrice[site.id]}" />
                                            </apex:outputText>
                                        </td>
                                        <td class="putDollarSign">
                                            <apex:outputText value="${0, number, ###,###,##0.00}">
                                                <apex:param value="{!mapSiteTotalOneTime[site.id]}" />
                                            </apex:outputText>                                    
                                        </td>                                                                              
                                    </tr>   
                                <apex:variable var="counter" value="{!counter+1}"/>                                 
                                </apex:repeat>
                            </tbody>
                        </table>
                        
                        <div class="col-xs-12 m-b-40 p0">
                            <div class="col-xs-5 col-md-5 pull-right p0 m0 quoteSummaryDiv">
                                <span class="quoteSummaryTitle" style="margin-left: 10px !important;"><b>Quote Pricing Summary</b></span>
                                    <apex:outputPanel id="subTotal" rendered="{!IF((quoteObj.Product__r.productcode == 'AVPN' || quoteObj.Product__r.productcode == 'AMIS'),true,false)}">
                                    <table id="pricingSmryTable" class="table subTotalSummary">
                                       <tr>
                                            <td style="font-size: initial; color:black;font-weight: bold;margin-bottom: 5px; margin-top: 20px"><strong>{!$Label.REVIEW_QT_SUBTT}</strong><span><small>&nbsp;{!$Label.DISC_APPLIED_VERB}</small></span></td>
                                            <td class="text-right" style="color:black;font-weight: bold;">
                                                <div class="monthlyTotalCharges" style="margin-right:-10px;">
                                                    <strong> 
                                                        <apex:outputText value="${0, number, ###,###,##0.00}/mo">
                                                            <apex:param value="{!monthlyTotal}" />
                                                        </apex:outputText>
                                                    </strong>
                                                </div>
                                            </td>
                                        </tr>
                                        <apex:outputPanel rendered="{!IF(specialPricingDiscount,false,true)}">
                                            <tr>
                                                <td class="additionalDiscount"><strong>Additional Discounts</strong></td>
                                                <td class="text-right additionalDiscount" >
                                                    <div class="oneTimeTotal" style="margin-right:-10px;">
                                                        <strong> 
                                                            <apex:outputText value="-${0, number, ###,###,##0.00}">
                                                                <apex:param value="{!monthlyDealRegDiscounts}" />
                                                            </apex:outputText>
                                                        </strong>
                                                        <apex:outputPanel rendered="{!promotionsExist}">
                                                            <span class="glyphicon glyphicon-chevron-down promotionPopover"></span>
                                                        </apex:outputPanel>
                                                    </div>                                                   
                                                </td>                                       
                                            </tr>
                                        </apex:outputPanel>
                                    </table> 
                                    <apex:outputPanel rendered="{!IF((specialPricingDiscount == true || promotionsExist == false),false,true)}">
                                        <div class="promotionAppliedData">
                                            <h5> Promotion Applied:</h5>
                                            <table class="promoTable">
                                                <apex:repeat rendered="{!IF(dealAndSpLevelPromotionList != null,true,false)}" value="{!dealAndSpLevelPromotionList}" var="promoAttr">    
                                                    <tr>
                                                        <td><apex:outputText value="{!promoAttr.Promotion_Name__c}" /></td>
                                                        <td><span style="padding-right:8px;">Saved</span>{!promoAttr.Discount_Percentage__c}%</td>
                                                        <td><apex:outputText value="{0, date, MM/dd/yy}" rendered="{!promoAttr.Display_Promotion_End_Date__c}">expires on
                                                                <apex:param value="{!promoAttr.End_Date__c}" />
                                                            </apex:outputText>
                                                        </td>
                                                    </tr>                                                                          
                                                </apex:repeat> 
                                            </table>
                                        </div> 
                                    </apex:outputPanel>                                 
                                    <hr class="grey_hr"/>
                                </apex:outputPanel>
                                <table id="pricingSmryTable" class="table">
                                    <apex:outputPanel rendered="{!IF((dealRegDiscount =false && DealRegistrationAmount!= null && DealRegistrationAmount> 0 && (quoteObj.Apttus_Proposal__Approval_Stage__c = $Label.Quote_Deal_Approved || quoteObj.Apttus_Proposal__Approval_Stage__c = 'Special Pricing Denied'))
                                    ||(specialPricingDiscount =true && specialPricingAmount!= null && specialPricingAmount> 0 && (quoteObj.Apttus_Proposal__Approval_Stage__c = $Label.Quote_Special_Pricing_Approved || quoteObj.Apttus_Proposal__Opportunity__r.Special_Pricing_Approved__c == true)) || (dealRegDiscount =false && DealRegistrationAmount!= null && DealRegistrationAmount> 0 && (quoteObj.Apttus_Proposal__Approval_Stage__c = $Label.Quote_Deal_Approved || quoteObj.Apttus_Proposal__Approval_Stage__c = 'Special Pricing Denied')) || (specialPricingDiscount =true && specialPricingAmount!= null && specialPricingAmount> 0 && (quoteObj.Apttus_Proposal__Approval_Stage__c = $Label.Quote_Special_Pricing_Approved || quoteObj.Apttus_Proposal__Opportunity__r.Special_Pricing_Approved__c == true || isSpecialPricing == true))
                                    ,true,false)}">
                                        <tr class="orangeText" style="font-weight:bold;">                                
                                            <td>
                                                <!--id="AddDiscount"-->
                                                <apex:outputPanel rendered="{!dealRegDiscount =true && specialPricingDiscount =false && DealRegistrationAmount!= null && DealRegistrationAmount> 0 && (quoteObj.Apttus_Proposal__Approval_Stage__c = $Label.Quote_Deal_Approved || quoteObj.Apttus_Proposal__Approval_Stage__c = 'Special Pricing Denied')}">
                                                    Deal Registration Discount
                                                </apex:outputPanel>
                                                <!--id="SpecialDiscount"-->
                                                <apex:outputPanel rendered="{!specialPricingDiscount =true && specialPricingAmount!= null && specialPricingAmount> 0 && (quoteObj.Apttus_Proposal__Approval_Stage__c = $Label.Quote_Special_Pricing_Approved || quoteObj.Apttus_Proposal__Opportunity__r.Special_Pricing_Approved__c == true || isSpecialPricing ==true)}">
                                                    Special Pricing Discount
                                                </apex:outputPanel>
                                            </td>
                                            <td class="text-right">
                                                <!--id="AddDiscount"-->
                                                 <apex:outputPanel rendered="{!dealRegDiscount =true && specialPricingDiscount = false && DealRegistrationAmount!= null && DealRegistrationAmount> 0 && (quoteObj.Apttus_Proposal__Approval_Stage__c = $Label.Quote_Deal_Approved || quoteObj.Apttus_Proposal__Approval_Stage__c = 'Special Pricing Denied')}">
                                                    <span>-</span>
                                                    <apex:outputText value="${0, number, ###,###,##0.00}/mo">
                                                        <apex:param value="{!DealRegistrationAmount}" />
                                                    </apex:outputText> 
                                                </apex:outputPanel>
                                                <!--id="SpecialDiscount"-->
                                               <apex:outputPanel rendered="{!specialPricingDiscount =true && specialPricingAmount!= null && specialPricingAmount> 0 && (quoteObj.Apttus_Proposal__Approval_Stage__c = $Label.Quote_Special_Pricing_Approved || quoteObj.Apttus_Proposal__Opportunity__r.Special_Pricing_Approved__c == true || isSpecialPricing == true)}">
                                                    <span>-</span> 
                                                    <apex:outputText value="${0, number, ###,###,##0.00}/mo">
                                                         <apex:param value="{!specialPricingAmount}" />
                                                     </apex:outputText> 
                                                </apex:outputPanel>
                                            </td>
                                        </tr>
                                    </apex:outputPanel>
                                    <tr>
                                        <td><strong><span style="color:black;font-weight: bold;">Monthly Total </span></strong></td>
                                        <td class="text-right" style="color:black;font-weight: bold;">
                                            <strong>
                                                 <apex:outputText value="${0, number, ###,###,##0.00}/mo">
                                                     <apex:param value="{!total}" />
                                                 </apex:outputText>
                                            </strong>
                                        </td>
                                    </tr>
                                    <tr style="color:black;font-weight: bold;">
                                        <td><strong>One-Time Total</strong></td>
                                        <td class="text-right">
                                            <strong style="margin-right: 0px;">
                                                <apex:outputText value="${0, number, ###,###,##0.00}">
                                                    <apex:param value="{!oneTimeTotal}" />
                                                </apex:outputText>      
                                            </strong> 
                                        </td>
                                    </tr>
                                    <tr>
                                        <td colspan="2">
                                            <p style="margin:0;font-size:11px;color:black;padding-top:0px">All prices shown are pre-tax.</p> 
                                        </td>
                                    </tr>  
                                </table>
                            </div>
                        </div>
                    </apex:outputPanel>
                </apex:outputPanel>
                </apex:outputPanel>
                
                <apex:outputPanel rendered="{!!isApprover && !showDenialReason && !AIAProduct}">
                    <p class="greenText f-s-xxl" style="font-family:omnes_att_iimedium;font-size:32px;">
                        {!$Label.Thank_you_1}
                    </p>
                    <p class="m-t-10" style="font-size:18px;font-family:omnes_att_iimedium;margin-bottom:85%;">
                        {!$Label.Non_Approver_Confirmation}
                    </p>
                </apex:outputPanel>
                
                <apex:outputPanel rendered="{!AIAProduct}">
                    <p class="greenText f-s-xxl greenTextStyle" style="font-family:omnes_att_iimedium;font-size:32px;">
                        Thank you!
                    </p>
                    <p class="confirmPara" style="margin-top:25px;font-size:16px;">Your order number {!quoteObj.Name} is being processed and provisioned.</p>
                    <p class="confirmPara" style="margin-top:7px;font-size:16px;">You will receive an email with your pricing summary.</p>
                    <p class="confirmPara" style="margin-top:25px;font-size:16px;">To check the status of your AT&amp;T Internet Access quote, go to <strong style="font-weight:bold;">My Dashboard</strong> under <strong style="font-weight:bold;">Manage Quotes &amp; Orders</strong>.</p>
                </apex:outputPanel>
                </div>
                <div style="margin-left: 115%;margin-left;margin-top: -82%;">
                    <a href="#" class="scrollToTop arrowImageDim"> <apex:image value="{!($Resource.TopArrow)}" styleClass="arrowImageDim"/></a>
                </div>
                <div class="alignDashboardLinkMT">
                    <hr class="dividerHr" style="margin-bottom:3%;" />
                     <div class="alignDashboardLinkMB">
                       <a href="/apex/PortalDashboard_UI" class="attLinkBlue" style="line-height:0px !important;">{!$Label.Dashboard}</a>
                      </div>
                </div>
            <br/>            
        </div>
    </apex:form>
    <script>
            jQuery.extend( jQuery.fn.dataTableExt.oSort, {
                "currency-pre": function ( a ) {
                    a = (a==="-") ? 0 : a.replace( /[^\d\-\.]/g, "" );
                    return parseFloat( a );
                },
             
                "currency-asc": function ( a, b ) {
                    return a - b;
                },
             
                "currency-desc": function ( a, b ) {
                    return b - a;
                }
            });
            var siteTable = $('#sitesTable').DataTable({
                "columnDefs": [{ type: 'currency', targets: 2 }],
                "aaSorting": [[ 2, 'asc' ]],
                "bPaginate": false,
                "bFilter": false,
                "bInfo": false
                
            }); 
            $('.sorting').click(function () {setBG();});
            function setBG(){
                var custListSize = {!numberOfSites};
                for (i = 0; i < custListSize; i++) { 
                    var promoData="";
                    var tableRowNum = '.row_'+i;
                    var tableRow = $(tableRowNum);
                    var row = siteTable.row(tableRow);
                    var promotionAppliedObj = tableRow.find('div.promotionAppliedForSite');
                    if(promotionAppliedObj != null && typeof promotionAppliedObj != "undefined"){
                        promoData = promotionAppliedObj.html();
                    }
                    if(typeof promoData != "undefined" && promoData != "" && promoData != null && promoData.trim().length>0){
                        if(tableRow.hasClass('odd')){
                            row.child( promoData, 'odd sitePromotion').show();
                        }
                        else{
                            row.child( promoData, 'even sitePromotion').show();
                        }
                        tableRow.addClass('shown');
                        $( tableRow.addClass('shown') );
                    }
                }
                
            }           
            function showApplyPromotion(){
                $('.glyphicon-chevron-down').on('click',function(){
                    $('.promotionAppliedData').toggle();
                    $('.promotionPopover').toggleClass('glyphicon-chevron-down glyphicon-chevron-up');
                });
            }
         function sortTable(table, col, reverse) {
            var tb = table.tBodies[0], // use `<tbody>` to ignore `<thead>` and `<tfoot>` rows
                tr = Array.prototype.slice.call(tb.rows, 0), // put rows into array
                i;
            reverse = -((+reverse) || -1);
            tr = tr.sort(function (a, b) { // sort rows
                return reverse // `-1 *` if want opposite order
                    * (a.cells[col].textContent.trim() // using `.textContent.trim()` for test
                        .localeCompare(b.cells[col].textContent.trim())
                       );
            });
            for(i = 0; i < tr.length; ++i) tb.appendChild(tr[i]); // append each row in order
        }
        function makeSortable(table) {
            var th = table.tHead, i;
            th && (th = th.rows[0]) && (th = th.cells);
            if (th) i = th.length;
            else return; // if no `<thead>` then do nothing
            while (--i >= 0) (function (i) {
                var dir = 1;
                if(i != 4){
                    th[i].childNodes[1].addEventListener('click', function () {sortTable(table, i, (dir = 1 - dir))});
                }
            }(i));
        }
        function makeAllSortable(parent) {
            parent = parent || document.body;
            var t = parent.getElementsByClassName('sitesDataTable');
            makeSortable(t[0]);
        }
        
         jQuery(document).ready(function($){
          
        setBG();
        setTimeout(function(){ makeAllSortable(); }, 2000);   
        $(window).scroll(function(){
                if ($(this).scrollTop() > 100) {
                    $('.scrollToTop').fadeIn();
                } else {
                    $('.scrollToTop').fadeOut();
                }
            });
            $('.scrollToTop').click(function(){
                $('html, body').animate({scrollTop : 0},500);
                return false;
            }); $(window).scroll(function(){
                if ($(this).scrollTop() > 100) {
                    $('.scrollToTop').fadeIn();
                } else {
                    $('.scrollToTop').fadeOut();
                }
            });
            $('.scrollToTop').click(function(){
                $('html, body').animate({scrollTop : 0},500);
                return false;
         }); 
            showApplyPromotion(); 
            var productType = "{!quoteObj.Product__r.productcode}";
            if("undefined" != typeof productType && productType != null && (productType=="AVPN" || productType == "AMIS")){
                uploadOrderConfirmationPDF();
            }
        });
        
        function uploadOrderConfirmationPDF(){            
            if($('.glyphicon-chevron-down').length>0){
                $('.glyphicon-chevron-down').click();
            }           
            if(typeof $('#walkme-player') != 'undefined'){
                $('#walkme-player').hide();
            }
            setTimeout(function(){
                var opptyId = "{!opptyId}";
                if("undefined" != typeof opptyId && opptyId != null && opptyId != ""){                  
                    var canvasHeight = $(document).height();
                    var canvasWidth = $(document).width(); 
                    var pdf = new jsPDF('p', 'pt',[canvasHeight,canvasWidth]);
                    var attachment="";
                    pdf.addHTML(document.body,function(){
                        attachment = window.btoa(pdf.output());
                    }); 
                    setTimeout(function(){
                        if(attachment.length>0){
                            $('#loading').parent().show();
                            submitOrderController.uploadOrderConfirmationPDF(
                                opptyId,attachment, 
                                function(result, event) {
                                    if(event.statusCode == '200'){
                                    $('#loading').parent().hide();
                                }
                                else{
                                    console.log('inside uploadOrderConfirmationPDF attachment size: '+attachment.length);
                                    $('#loading').parent().hide();
                                }
                            });   
                            if($('.promotionAppliedData').length>0){
                                $('.promotionAppliedData').toggle();
                                $('.promotionPopover').toggleClass('glyphicon-chevron-down glyphicon-chevron-up');
                            }
                        }
                        else{
                            console.log('attachment else '+attachment.length);
                            uploadOrderConfirmationPDF();
                        }
                    },200);
                }
                else{
                     $('#loading').parent().hide();
                }
            },300);
        }
    </script>
</apex:page>